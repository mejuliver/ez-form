"use strict";function postForm(e){this.ops={form:!1,formData:{},headers:{Accept:"application/json"},validators:{items:{},messages:{}},method:"POST",notif:!0,onsuccess:function(){},onerror:function(){}},this.data=function(){let t=document.querySelector('meta[name="csrf-token"]')?document.querySelector('meta[name="csrf-token"]').content:"";t=o.ops.form.querySelector("_token")?o.ops.form.querySelector("_token").value:t,this.ops.headers["X-CSRF-TOKEN"]=t;let o=this,s=this.ops.headers;this.ops.headers={headers:s,...e.headers};let a={};return Object.keys(this.ops.formData).forEach(e=>{a[e]=o.ops.formData[e].value}),{url:this.ops.url,form:this.ops.form,formData:a,isLoading:!1,notifbox:document.querySelector("#ppf-notif"),headers:this.ops.headers,method:this.ops.method}},this.validate=function(e,t){if(!e)return{success:!1,message:"Data is empty",errors:["data is empty"]};let o=this,s=[{name:"required",action:function(e){return!(!e&&0!=e)},message:"{name} is required"},{name:"email",action:function(e){return e.match(/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)},message:"{name} must be a valid email"},{name:"number",action:function(e){return/^[0-9]+$/.test(e)},message:"{name} must contains only numbers"},{name:"string",action:function(e){return/^[a-zA-Z]*$/g.test(e)},message:"{name} must be string"}],a=[];return Object.keys(e).forEach(n=>{let i=e[n].split("|"),r=[];i.forEach(e=>{let a=s.find(t=>t.name==e);i.includes("nullable")||!a||a.action(o.data().formData[n])||(t[n+"."+e]?r.push(t[n+"."+e].replaceAll("{name}",n.replaceAll("_"," ").toLowerCase())):r.push(a.message.replaceAll("{name}",n.replaceAll("_"," ").toLowerCase())))}),r.length>0&&a.concat(r)}),a},this.events=function(){let e=this;this.data().form.addEventListener("submit",function(){event.preventDefault();let t=e.validate(e.ops.validators.items,e.ops.validators.messages);if(t.length>0)e.ops.notif&&e.notif("error",t.join(", ")),e.ops.onerror(t);else{let t=new FormData,o=e.data(),s=o.formData;Object.keys(s).forEach(e=>{t.append(e,s[e])}),fetch(o.url,{method:o.method,body:t,headers:o.headers}).then(e=>e.json()).then(t=>{e.ops.notif&&e.notif("success",t.message),e.ops.onsuccess(t)}).catch(t=>{let o=[],s="";t.errors?(Object.keys(t.errors).forEach(e=>{o.push(t.errors[e])}),s=o.join(", ")):s=t.message,e.ops.notif&&e.notif("error",s),e.ops.onerror(t)})}})},this.notif=function(e,t,o){if(!this.data().notifbox){let e=document.createElement("div");e.setAttribute("id","ppf-notif"),e.classList.add("ppf-notif"),e.setAttribute("style","position:fixed;z-index:9999;display:none;font-size:16px;background:#fff;width:300px;z-index:9999;box-shadow:0 1px 6px 0 rgba(0,0,0,.12),0 1px 6px 0 rgba(0,0,0,.12);bottom:20px;right:20px"),e.innerHTML='<div class="ppf-notif-content" style="padding:16px;height:100%;width:100%;display:flex;align-items:center"><div class="ppf-notif-icon" style="width:32px;height:32px;margin-right:8px"></div><span class="ppf-notif-message"></span></div>',document.querySelector("body").appendChild(e)}"success"==e?this.data().notifbox.querySelector(".ppf-notif-icon").innerHTML='<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-circle-check" viewBox="0 0 24 24" stroke-width="1.5" stroke="#42ba96" fill="none" stroke-linecap="round" stroke-linejoin="round"><path fill="none" d="M0 0h24v24H0z" stroke="none"></path><path d="M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0"></path><path d="M9 12l2 2l4 -4"></path></svg>':"error"==e&&(this.data().notifbox.querySelector(".ppf-notif-icon").innerHTML='<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-exclamation-circle" viewBox="0 0 24 24" stroke-width="1.5" stroke="#ff3333" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0"/><path d="M12 9v4"/><path d="M12 16v.01"/></svg>'),t&&(this.data().notifbox.querySelector(".ppf-notif-message").textContent=t),o&&"show"!=o?"hide"==o&&(this.data().notifbox.classList.add("hide"),this.data().style.display="none"):(this.data().notifbox.classList.add("show"),this.data().style.display="block")},this.init=function(){let t=this;if(e)if(e.hasOwnProperty("form"))if(this.ops.form=document.querySelector(e.form),this.ops.form){if(e.hasOwnProperty("formData")&&e.formData.forEach(e=>{t.ops.formData[e.name]=form.querySelector(e.name),e.validate&&(t.ops.validators.items[e.name]=e.validate),e.validate_message&&Object.keys(e.validate_message).forEach(o=>{t.ops.validators.messages[e.name+"."+o]=e.validate_message[o]})}),e.hasOwnProperty("headers")){let t=this.ops.headers;this.ops.headers={headers:t,...e.headers}}e.hasOwnProperty("method")&&(this.ops.method=e.method),e.hasOwnProperty("notif")&&(this.ops.notif=e.notif),e.hasOwnProperty("onsuccess")&&(this.ops.onsuccess=e.onsuccess),e.hasOwnProperty("onerror")&&(this.ops.onerror=e.onerror),this.events()}else console.log("wfa form plugin: form not found, init failed");else console.log("wfa form plugin: no form provided, init failed");else console.log("wfa form plugin: no options provided, init failed")},this.init()}
